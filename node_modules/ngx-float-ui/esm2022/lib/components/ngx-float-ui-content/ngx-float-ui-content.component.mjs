import { NgClass, NgIf, NgStyle } from "@angular/common";
import { ChangeDetectionStrategy, Component, EventEmitter, HostListener, ViewChild, ViewEncapsulation } from "@angular/core";
//
import { arrow, autoPlacement, autoUpdate, computePosition, flip, limitShift, offset, shift } from "@floating-ui/dom";
import { fromEvent, Subject, takeUntil } from "rxjs";
import { NgxFloatUiPlacements } from "../../models/ngx-float-ui-placements.model";
import { NgxFloatUiTriggers } from "../../models/ngx-float-ui-triggers.model";
import * as i0 from "@angular/core";
export class NgxFloatUiContentComponent {
    elRef;
    _viewRef;
    _changeDetectorRef;
    static nextId = 0;
    get _dynamicArrowSides() {
        return {
            top: "left",
            right: "top",
            bottom: "left",
            left: "top"
        };
    }
    get _sideAxis() {
        return {
            left: "x",
            top: "y",
            right: "x",
            bottom: "y"
        };
    }
    get _staticArrowSides() {
        return {
            top: "bottom",
            right: "left",
            bottom: "top",
            left: "right"
        };
    }
    ariaHidden;
    arrowColor = null;
    displayType;
    floatUiOptions = {
        disableAnimation: false,
        disableDefaultStyling: false,
        boundariesElement: "",
        trigger: NgxFloatUiTriggers.hover,
        positionFixed: false,
        appendToBody: false,
        popperModifiers: []
    };
    floatUiSwitch;
    floatUiViewRef;
    id = `ngx_float_ui_${++NgxFloatUiContentComponent.nextId}`;
    isMouseOver = !1;
    onHidden = new EventEmitter();
    onUpdate;
    opacity;
    referenceObject;
    state;
    text;
    _destroy$ = new Subject();
    _resizeCtrl$ = new Subject();
    _styleId = `${this.id}_style`;
    constructor(elRef, _viewRef, _changeDetectorRef) {
        this.elRef = elRef;
        this._viewRef = _viewRef;
        this._changeDetectorRef = _changeDetectorRef;
        this._toggleVisibility(!1);
    }
    clean() {
        this.toggleVisibility(false);
        if (!this.floatUiSwitch) {
            return;
        }
        this.floatUiSwitch();
    }
    extractAppliedClassListExpr(classList = []) {
        const klassList = Array.isArray(classList) ? classList : typeof classList === typeof "" ? classList.replace(/ /, "").split(",") : [];
        return klassList.reduce((acc, klass) => {
            acc[klass] = !0;
            return acc;
        }, {});
    }
    hide() {
        if (this.floatUiSwitch) {
            this.floatUiSwitch();
        }
        this.toggleVisibility(!1);
        this.onHidden.emit();
    }
    ngOnDestroy() {
        this._destroy$.next();
        this.clean();
        if (this.floatUiOptions.appendTo && this.elRef && this.elRef.nativeElement && this.elRef.nativeElement.parentNode) {
            this._viewRef.detach();
            this.elRef.nativeElement.parentNode.removeChild(this.elRef.nativeElement);
        }
    }
    onDocumentResize() {
        this.update();
    }
    onMouseOver() {
        this.isMouseOver = true;
    }
    show() {
        if (!this.referenceObject) {
            return;
        }
        this._resizeCtrl$.next();
        this._determineArrowColor();
        this.floatUiSwitch = autoUpdate(this.referenceObject, this.floatUiViewRef.nativeElement, () => {
            this._computePosition();
        });
        fromEvent(document, "resize")
            .pipe(takeUntil(this._resizeCtrl$), takeUntil(this._destroy$))
            .subscribe({
            next: () => this.onDocumentResize()
        });
    }
    showOnLeave() {
        this.isMouseOver = false;
        if (this.floatUiOptions.trigger !== NgxFloatUiTriggers.hover && !this.floatUiOptions.hideOnMouseLeave) {
            return;
        }
        this.hide();
    }
    // Toggle visibility and detect changes - Run only after ngOnInit!
    toggleVisibility(state) {
        this._toggleVisibility(state);
        // tslint:disable-next-line:no-string-literal
        if (!this._changeDetectorRef["destroyed"]) {
            this._changeDetectorRef.detectChanges();
        }
    }
    update() {
        this._computePosition();
    }
    _computePosition() {
        const appendToParent = this.floatUiOptions.appendTo && document.querySelector(this.floatUiOptions.appendTo);
        if (appendToParent) {
            const parent = this.elRef.nativeElement.parentNode;
            if (parent !== appendToParent) {
                parent && parent.removeChild(this.elRef.nativeElement);
                appendToParent.appendChild(this.elRef.nativeElement);
            }
        }
        const arrowElement = this.elRef.nativeElement.querySelector(".float-ui-arrow");
        const arrowLen = arrowElement.offsetWidth;
        // Get half the arrow box's hypotenuse length
        const floatingOffset = Math.sqrt(2 * arrowLen ** 2) / 2;
        const parsedAutoAlignment = (this.floatUiOptions.placement?.replace("auto-", "") || void 0);
        // Since "auto" doesn't really exist in floating-ui we pass undefined to have auto
        const parsedPlacement = !this.floatUiOptions.placement || this.floatUiOptions.placement.indexOf(NgxFloatUiPlacements.AUTO) === 0
            ? void 0
            : this.floatUiOptions.placement;
        const popperOptions = {
            placement: parsedPlacement,
            strategy: this.floatUiOptions.positionFixed ? "fixed" : "absolute",
            middleware: [
                offset(floatingOffset),
                ...(this.floatUiOptions.preventOverflow
                    ? [flip()]
                    : []),
                shift({ limiter: limitShift() }),
                arrow({
                    element: arrowElement,
                    padding: 4
                })
            ]
        };
        // Since preventOverflow uses "flip" and "flip" can't be used with "autoPlacement" we get here only if both conditions are falsy
        if (!this.floatUiOptions.preventOverflow && !popperOptions.placement) {
            const boundariesElement = this.floatUiOptions.boundariesElement
                ? document.querySelector(this.floatUiOptions.boundariesElement)
                : this.referenceObject.parentElement;
            popperOptions.middleware.push(autoPlacement({
                crossAxis: !0,
                alignment: parsedAutoAlignment,
                autoAlignment: this.floatUiOptions.placement === NgxFloatUiPlacements.AUTO,
                boundary: boundariesElement
            }));
        }
        computePosition(this.referenceObject, this.floatUiViewRef.nativeElement, {
            ...popperOptions
        })
            .then(({ middlewareData, x, y, placement }) => {
            const side = placement.split("-")[0];
            this.floatUiViewRef.nativeElement.setAttribute("data-float-ui-placement", side);
            if (middlewareData.arrow) {
                const staticArrowSide = this._staticArrowSides[side];
                const dynamicArrowSide = this._dynamicArrowSides[side];
                const dynamicSideAxis = this._sideAxis[dynamicArrowSide];
                Object.assign(arrowElement.style, {
                    top: "",
                    bottom: "",
                    left: "",
                    right: "",
                    [dynamicArrowSide]: middlewareData.arrow[dynamicSideAxis] != null ? `${middlewareData.arrow[dynamicSideAxis]}px` : "",
                    [staticArrowSide]: `${-arrowLen / 2}px`
                });
            }
            Object.assign(this.floatUiViewRef.nativeElement.style, {
                left: `${x}px`,
                top: `${y}px`
            });
            this.toggleVisibility(!0);
            this.onUpdate?.();
        });
    }
    _createArrowSelector() {
        return `div#${this.id}.float-ui-container > .float-ui-arrow.ngxp__force-arrow`;
    }
    _determineArrowColor() {
        if (!this.floatUiOptions.styles || this.arrowColor) {
            return !1;
        }
        const ruleValue = this.floatUiOptions.styles["background-color"] || this.floatUiOptions.styles.backgroundColor;
        if (this.arrowColor === ruleValue) {
            return !1;
        }
        this.arrowColor = ruleValue;
        let $style = document.querySelector(`#${this._styleId}`);
        const styleContent = this.arrowColor ?
            `${this._createArrowSelector()}:before { background-color: ${this.arrowColor}; }` : "";
        if (!$style) {
            $style = document.createElement("style");
            $style.id = this._styleId;
            $style.setAttribute("type", "text/css");
            document.head.appendChild($style);
        }
        // tslint:disable-next-line:no-string-literal
        if ($style["styleSheet"]) {
            // tslint:disable-next-line:no-string-literal
            $style["styleSheet"].cssText = styleContent;
            // This is required for IE8 and below.
        }
        else {
            $style.innerHTML = styleContent;
        }
    }
    _toggleVisibility(state) {
        this.displayType = ["none", "block"][+state];
        this.opacity = +state;
        this.ariaHidden = `${!state}`;
        this.state = state;
    }
    /** @nocollapse */ static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: NgxFloatUiContentComponent, deps: [{ token: i0.ElementRef }, { token: i0.ViewContainerRef }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component });
    /** @nocollapse */ static ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "18.0.4", type: NgxFloatUiContentComponent, isStandalone: true, selector: "float-ui-content", host: { listeners: { "mouseover": "onMouseOver()", "mouseleave": "showOnLeave()" } }, viewQueries: [{ propertyName: "floatUiViewRef", first: true, predicate: ["floatUiViewRef"], descendants: true, static: true }], exportAs: ["ngxFloatUiContent"], ngImport: i0, template: "<div #floatUiViewRef\n     [attr.id]=\"id\"\n     [class.float-ui-container]=\"!floatUiOptions.disableDefaultStyling\"\n     [class.float-ui-animation]=\"!floatUiOptions.disableAnimation\"\n     [class.float-ui-fixed]=\"floatUiOptions.positionFixed\"\n     [style.display]=\"displayType\"\n     [style.opacity]=\"opacity\"\n     [ngStyle]=\"floatUiOptions.styles\"\n     [ngClass]=\"extractAppliedClassListExpr(floatUiOptions.applyClass)\"\n     attr.aria-hidden=\"{{ariaHidden}}\"\n     [attr.aria-describedby]=\"floatUiOptions.ariaDescribe || null\"\n     attr.role=\"{{floatUiOptions.ariaRole}}\">\n    <div *ngIf=\"text\"\n         class=\"ngxp__inner\"\n         [innerHTML]=\"text\">\n        <ng-content></ng-content>\n    </div>\n    <div *ngIf=\"!text\"\n         class=\"ngxp__inner\">\n        <ng-content></ng-content>\n    </div>\n    <div class=\"float-ui-arrow\"\n         [class.ngxp__force-arrow]=\"arrowColor\"\n         [ngClass]=\"extractAppliedClassListExpr(floatUiOptions.applyArrowClass)\"></div>\n\n</div>\n", styles: ["float-ui-content{position:relative;display:block}.float-ui-container{display:none;position:absolute;border-radius:3px;border:1px solid grey;box-shadow:0 0 2px #00000080;padding:10px}.float-ui-container.float-ui-fixed{position:fixed}.float-ui-container.float-ui-animation{-webkit-animation:ngxp-fadeIn .15s ease-out;-moz-animation:ngxp-fadeIn .15s ease-out;-o-animation:ngxp-fadeIn .15s ease-out;animation:ngxp-fadeIn .15s ease-out;transition:transform .65s cubic-bezier(.43,.33,.14,1.01) 0s}.float-ui-container>.float-ui-arrow{position:absolute;width:10px;height:10px;z-index:-1;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{display:block;opacity:1}}@keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{display:block;opacity:1}}\n"], dependencies: [{ kind: "directive", type: NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }, { kind: "directive", type: NgClass, selector: "[ngClass]", inputs: ["class", "ngClass"] }, { kind: "directive", type: NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush, encapsulation: i0.ViewEncapsulation.None });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.0.4", ngImport: i0, type: NgxFloatUiContentComponent, decorators: [{
            type: Component,
            args: [{ selector: "float-ui-content", encapsulation: ViewEncapsulation.None, changeDetection: ChangeDetectionStrategy.OnPush, exportAs: "ngxFloatUiContent", standalone: true, imports: [NgStyle, NgClass, NgIf], template: "<div #floatUiViewRef\n     [attr.id]=\"id\"\n     [class.float-ui-container]=\"!floatUiOptions.disableDefaultStyling\"\n     [class.float-ui-animation]=\"!floatUiOptions.disableAnimation\"\n     [class.float-ui-fixed]=\"floatUiOptions.positionFixed\"\n     [style.display]=\"displayType\"\n     [style.opacity]=\"opacity\"\n     [ngStyle]=\"floatUiOptions.styles\"\n     [ngClass]=\"extractAppliedClassListExpr(floatUiOptions.applyClass)\"\n     attr.aria-hidden=\"{{ariaHidden}}\"\n     [attr.aria-describedby]=\"floatUiOptions.ariaDescribe || null\"\n     attr.role=\"{{floatUiOptions.ariaRole}}\">\n    <div *ngIf=\"text\"\n         class=\"ngxp__inner\"\n         [innerHTML]=\"text\">\n        <ng-content></ng-content>\n    </div>\n    <div *ngIf=\"!text\"\n         class=\"ngxp__inner\">\n        <ng-content></ng-content>\n    </div>\n    <div class=\"float-ui-arrow\"\n         [class.ngxp__force-arrow]=\"arrowColor\"\n         [ngClass]=\"extractAppliedClassListExpr(floatUiOptions.applyArrowClass)\"></div>\n\n</div>\n", styles: ["float-ui-content{position:relative;display:block}.float-ui-container{display:none;position:absolute;border-radius:3px;border:1px solid grey;box-shadow:0 0 2px #00000080;padding:10px}.float-ui-container.float-ui-fixed{position:fixed}.float-ui-container.float-ui-animation{-webkit-animation:ngxp-fadeIn .15s ease-out;-moz-animation:ngxp-fadeIn .15s ease-out;-o-animation:ngxp-fadeIn .15s ease-out;animation:ngxp-fadeIn .15s ease-out;transition:transform .65s cubic-bezier(.43,.33,.14,1.01) 0s}.float-ui-container>.float-ui-arrow{position:absolute;width:10px;height:10px;z-index:-1;-webkit-transform:rotate(45deg);-ms-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{display:block;opacity:1}}@keyframes ngxp-fadeIn{0%{display:none;opacity:0}1%{display:block;opacity:0}to{display:block;opacity:1}}\n"] }]
        }], ctorParameters: () => [{ type: i0.ElementRef }, { type: i0.ViewContainerRef }, { type: i0.ChangeDetectorRef }], propDecorators: { floatUiViewRef: [{
                type: ViewChild,
                args: ["floatUiViewRef", { static: !0 }]
            }], onMouseOver: [{
                type: HostListener,
                args: ["mouseover"]
            }], showOnLeave: [{
                type: HostListener,
                args: ["mouseleave"]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWZsb2F0LXVpLWNvbnRlbnQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LWZsb2F0LXVpL3NyYy9saWIvY29tcG9uZW50cy9uZ3gtZmxvYXQtdWktY29udGVudC9uZ3gtZmxvYXQtdWktY29udGVudC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtZmxvYXQtdWkvc3JjL2xpYi9jb21wb25lbnRzL25neC1mbG9hdC11aS1jb250ZW50L25neC1mbG9hdC11aS1jb250ZW50LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBQyxNQUFNLGlCQUFpQixDQUFDO0FBQ3ZELE9BQU8sRUFDSCx1QkFBdUIsRUFFdkIsU0FBUyxFQUVULFlBQVksRUFDWixZQUFZLEVBRVosU0FBUyxFQUVULGlCQUFpQixFQUNwQixNQUFNLGVBQWUsQ0FBQztBQUN2QixFQUFFO0FBQ0YsT0FBTyxFQUVILEtBQUssRUFDTCxhQUFhLEVBQ2IsVUFBVSxFQUNWLGVBQWUsRUFFZixJQUFJLEVBQ0osVUFBVSxFQUNWLE1BQU0sRUFFTixLQUFLLEVBQ1IsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQixPQUFPLEVBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUMsTUFBTSxNQUFNLENBQUM7QUFHbkQsT0FBTyxFQUFDLG9CQUFvQixFQUFDLE1BQU0sNENBQTRDLENBQUM7QUFDaEYsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sMENBQTBDLENBQUM7O0FBWTVFLE1BQU0sT0FBTywwQkFBMEI7SUEwRGhCO0lBQ0c7SUFDQTtJQTFEdEIsTUFBTSxDQUFDLE1BQU0sR0FBVyxDQUFDLENBQUM7SUFFMUIsSUFBYyxrQkFBa0I7UUFDNUIsT0FBTztZQUNILEdBQUcsRUFBRSxNQUFN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LENBQUMsRUFBRSxDQUFDO1lBQ3ZCLDZDQUE2QztZQUM3QyxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxHQUFHLFlBQVksQ0FBQztZQUM1QyxzQ0FBc0M7UUFDMUMsQ0FBQzthQUNJLENBQUM7WUFDRixNQUFNLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQztRQUNwQyxDQUFDO0lBQ0wsQ0FBQztJQUVTLGlCQUFpQixDQUFDLEtBQUs7UUFDN0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUM7UUFDdEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDOUIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDdkIsQ0FBQzswSEE3UVEsMEJBQTBCOzhHQUExQiwwQkFBMEIsbVVDM0N2Qyx5Z0NBMEJBLDI2QkRlYyxPQUFPLDJFQUFFLE9BQU8sb0ZBQUUsSUFBSTs7MkZBRXZCLDBCQUEwQjtrQkFWdEMsU0FBUzsrQkFDSSxrQkFBa0IsaUJBQ2IsaUJBQWlCLENBQUMsSUFBSSxtQkFDcEIsdUJBQXVCLENBQUMsTUFBTSxZQUdyQyxtQkFBbUIsY0FDakIsSUFBSSxXQUNQLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUM7OElBOENVLGNBQWM7c0JBQXhELFNBQVM7dUJBQUMsZ0JBQWdCLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUM7Z0JBNER6QyxXQUFXO3NCQURWLFlBQVk7dUJBQUMsV0FBVztnQkE2QnpCLFdBQVc7c0JBRFYsWUFBWTt1QkFBQyxZQUFZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtOZ0NsYXNzLCBOZ0lmLCBOZ1N0eWxlfSBmcm9tIFwiQGFuZ3VsYXIvY29tbW9uXCI7XG5pbXBvcnQge1xuICAgIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICAgIENoYW5nZURldGVjdG9yUmVmLFxuICAgIENvbXBvbmVudCxcbiAgICBFbGVtZW50UmVmLFxuICAgIEV2ZW50RW1pdHRlcixcbiAgICBIb3N0TGlzdGVuZXIsXG4gICAgT25EZXN0cm95LFxuICAgIFZpZXdDaGlsZCxcbiAgICBWaWV3Q29udGFpbmVyUmVmLFxuICAgIFZpZXdFbmNhcHN1bGF0aW9uXG59IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG4vL1xuaW1wb3J0IHtcbiAgICBBbGlnbm1lbnQsXG4gICAgYXJyb3csXG4gICAgYXV0b1BsYWNlbWVudCxcbiAgICBhdXRvVXBkYXRlLFxuICAgIGNvbXB1dGVQb3NpdGlvbixcbiAgICBDb21wdXRlUG9zaXRpb25Db25maWcsXG4gICAgZmxpcCxcbiAgICBsaW1pdFNoaWZ0LFxuICAgIG9mZnNldCxcbiAgICBQbGFjZW1lbnQsXG4gICAgc2hpZnRcbn0gZnJvbSBcIkBmbG9hdGluZy11aS9kb21cIjtcbmltcG9ydCB7ZnJvbUV2ZW50LCBTdWJqZWN0LCB0YWtlVW50aWx9IGZyb20gXCJyeGpzXCI7XG4vL1xuaW1wb3J0IHtOZ3hGbG9hdFVpT3B0aW9uc30gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtZmxvYXQtdWktb3B0aW9ucy5tb2RlbFwiO1xuaW1wb3J0IHtOZ3hGbG9hdFVpUGxhY2VtZW50c30gZnJvbSBcIi4uLy4uL21vZGVscy9uZ3gtZmxvYXQtdWktcGxhY2VtZW50cy5tb2RlbFwiO1xuaW1wb3J0IHtOZ3hGbG9hdFVpVHJpZ2dlcnN9IGZyb20gXCIuLi8uLi9tb2RlbHMvbmd4LWZsb2F0LXVpLXRyaWdnZXJzLm1vZGVsXCI7XG5cbkBDb21wb25lbnQoe1xuICAgIHNlbGVjdG9yOiBcImZsb2F0LXVpLWNvbnRlbnRcIixcbiAgICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lLFxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vbmd4LWZsb2F0LXVpLWNvbnRlbnQuY29tcG9uZW50Lmh0bWxcIixcbiAgICBzdHlsZVVybHM6IFtcIi4vbmd4LWZsb2F0LXVpLWNvbnRlbnQuY29tcG9uZW50LnNjc3NcIl0sXG4gICAgZXhwb3J0QXM6IFwibmd4RmxvYXRVaUNvbnRlbnRcIixcbiAgICBzdGFuZGFsb25lOiB0cnVlLFxuICAgIGltcG9ydHM6IFtOZ1N0eWxlLCBOZ0NsYXNzLCBOZ0lmXVxufSlcbmV4cG9ydCBjbGFzcyBOZ3hGbG9hdFVpQ29udGVudENvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSB7XG5cbiAgICBzdGF0aWMgbmV4dElkOiBudW1iZXIgPSAwO1xuXG4gICAgcHJvdGVjdGVkIGdldCBfZHluYW1pY0Fycm93U2lkZXMoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3A6IFwibGVmdFwiLFxuICAgICAgICAgICAgcmlnaHQ6IFwidG9wXCIsXG4gICAgICAgICAgICBib3R0b206IFwibGVmdFwiLFxuICAgICAgICAgICAgbGVmdDogXCJ0b3BcIlxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgX3NpZGVBeGlzKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGVmdDogXCJ4XCIsXG4gICAgICAgICAgICB0b3A6IFwieVwiLFxuICAgICAgICAgICAgcmlnaHQ6IFwieFwiLFxuICAgICAgICAgICAgYm90dG9tOiBcInlcIlxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBnZXQgX3N0YXRpY0Fycm93U2lkZXMoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3A6IFwiYm90dG9tXCIsXG4gICAgICAgICAgICByaWdodDogXCJsZWZ0XCIsXG4gICAgICAgICAgICBib3R0b206IFwidG9wXCIsXG4gICAgICAgICAgICBsZWZ0OiBcInJpZ2h0XCJcbiAgICAgICAgfTtcbiAgICB9XG5cbiAgICBhcmlhSGlkZGVuOiBzdHJpbmc7XG4gICAgYXJyb3dDb2xvcjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgZGlzcGxheVR5cGU6IHN0cmluZztcbiAgICBmbG9hdFVpT3B0aW9uczogTmd4RmxvYXRVaU9wdGlvbnMgPSB7XG4gICAgICAgIGRpc2FibGVBbmltYXRpb246IGZhbHNlLFxuICAgICAgICBkaXNhYmxlRGVmYXVsdFN0eWxpbmc6IGZhbHNlLFxuICAgICAgICBib3VuZGFyaWVzRWxlbWVudDogXCJcIixcbiAgICAgICAgdHJpZ2dlcjogTmd4RmxvYXRVaVRyaWdnZXJzLmhvdmVyLFxuICAgICAgICBwb3NpdGlvbkZpeGVkOiBmYWxzZSxcbiAgICAgICAgYXBwZW5kVG9Cb2R5OiBmYWxzZSxcbiAgICAgICAgcG9wcGVyTW9kaWZpZXJzOiBbXVxuICAgIH0gYXMgTmd4RmxvYXRVaU9wdGlvbnM7XG4gICAgZmxvYXRVaVN3aXRjaDogKCkgPT4gdm9pZDtcbiAgICBAVmlld0NoaWxkKFwiZmxvYXRVaVZpZXdSZWZcIiwge3N0YXRpYzogITB9KSBmbG9hdFVpVmlld1JlZjogRWxlbWVudFJlZjtcbiAgICBpZDogc3RyaW5nID0gYG5neF9mbG9hdF91aV8keysrTmd4RmxvYXRVaUNvbnRlbnRDb21wb25lbnQubmV4dElkfWA7XG4gICAgaXNNb3VzZU92ZXI6IGJvb2xlYW4gPSAhMTtcbiAgICBvbkhpZGRlbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBvblVwZGF0ZTogKCkgPT4gYW55O1xuICAgIG9wYWNpdHk6IG51bWJlcjtcbiAgICByZWZlcmVuY2VPYmplY3Q6IEhUTUxFbGVtZW50O1xuICAgIHN0YXRlOiBib29sZWFuO1xuICAgIHRleHQ6IHN0cmluZztcblxuICAgIHByb3RlY3RlZCBfZGVzdHJveSQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHByb3RlY3RlZCBfcmVzaXplQ3RybCQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHByb3RlY3RlZCBfc3R5bGVJZCA9IGAke3RoaXMuaWR9X3N0eWxlYDtcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBlbFJlZjogRWxlbWVudFJlZixcbiAgICAgICAgICAgICAgICBwcm90ZWN0ZWQgX3ZpZXdSZWY6IFZpZXdDb250YWluZXJSZWYsXG4gICAgICAgICAgICAgICAgcHJvdGVjdGVkIF9jaGFuZ2VEZXRlY3RvclJlZjogQ2hhbmdlRGV0ZWN0b3JSZWYpIHtcbiAgICAgICAgdGhpcy5fdG9nZ2xlVmlzaWJpbGl0eSghMSk7XG4gICAgfVxuXG4gICAgY2xlYW4oKSB7XG4gICAgICAgIHRoaXMudG9nZ2xlVmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICAgIGlmICghdGhpcy5mbG9hdFVpU3dpdGNoKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mbG9hdFVpU3dpdGNoKCk7XG4gICAgfVxuXG4gICAgZXh0cmFjdEFwcGxpZWRDbGFzc0xpc3RFeHByKGNsYXNzTGlzdDogc3RyaW5nIHwgc3RyaW5nW10gPSBbXSk6IG9iamVjdCB7XG4gICAgICAgIGNvbnN0IGtsYXNzTGlzdCA9IEFycmF5LmlzQXJyYXkoY2xhc3NMaXN0KSA/IGNsYXNzTGlzdCA6IHR5cGVvZiBjbGFzc0xpc3QgPT09IHR5cGVvZiBcIlwiID8gY2xhc3NMaXN0LnJlcGxhY2UoLyAvLCBcIlwiKS5zcGxpdChcIixcIikgOiBbXTtcblxuICAgICAgICByZXR1cm4ga2xhc3NMaXN0LnJlZHVjZSgoYWNjLCBrbGFzcykgPT4ge1xuICAgICAgICAgICAgYWNjW2tsYXNzXSA9ICEwO1xuXG4gICAgICAgICAgICByZXR1cm4gYWNjO1xuICAgICAgICB9LCB7fSk7XG4gICAgfVxuXG4gICAgaGlkZSgpOiB2b2lkIHtcbiAgICAgICAgaWYgKHRoaXMuZmxvYXRVaVN3aXRjaCkge1xuICAgICAgICAgICAgdGhpcy5mbG9hdFVpU3dpdGNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50b2dnbGVWaXNpYmlsaXR5KCExKTtcbiAgICAgICAgdGhpcy5vbkhpZGRlbi5lbWl0KCk7XG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuX2Rlc3Ryb3kkLm5leHQoKTtcbiAgICAgICAgdGhpcy5jbGVhbigpO1xuICAgICAgICBpZiAodGhpcy5mbG9hdFVpT3B0aW9ucy5hcHBlbmRUbyAmJiB0aGlzLmVsUmVmICYmIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCAmJiB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQucGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgdGhpcy5fdmlld1JlZi5kZXRhY2goKTtcbiAgICAgICAgICAgIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvbkRvY3VtZW50UmVzaXplKCkge1xuICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoXCJtb3VzZW92ZXJcIilcbiAgICBvbk1vdXNlT3ZlcigpIHtcbiAgICAgICAgdGhpcy5pc01vdXNlT3ZlciA9IHRydWU7XG4gICAgfVxuXG4gICAgc2hvdygpOiB2b2lkIHtcbiAgICAgICAgaWYgKCF0aGlzLnJlZmVyZW5jZU9iamVjdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Jlc2l6ZUN0cmwkLm5leHQoKTtcbiAgICAgICAgdGhpcy5fZGV0ZXJtaW5lQXJyb3dDb2xvcigpO1xuICAgICAgICB0aGlzLmZsb2F0VWlTd2l0Y2ggPSBhdXRvVXBkYXRlKFxuICAgICAgICAgICAgdGhpcy5yZWZlcmVuY2VPYmplY3QsXG4gICAgICAgICAgICB0aGlzLmZsb2F0VWlWaWV3UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29tcHV0ZVBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICAgIGZyb21FdmVudChkb2N1bWVudCwgXCJyZXNpemVcIilcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLl9yZXNpemVDdHJsJCksXG4gICAgICAgICAgICAgICAgdGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3kkKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgICAgICAgICAgbmV4dDogKCkgPT4gdGhpcy5vbkRvY3VtZW50UmVzaXplKClcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIEBIb3N0TGlzdGVuZXIoXCJtb3VzZWxlYXZlXCIpXG4gICAgc2hvd09uTGVhdmUoKSB7XG4gICAgICAgIHRoaXMuaXNNb3VzZU92ZXIgPSBmYWxzZTtcbiAgICAgICAgaWYgKHRoaXMuZmxvYXRVaU9wdGlvbnMudHJpZ2dlciAhPT0gTmd4RmxvYXRVaVRyaWdnZXJzLmhvdmVyICYmICF0aGlzLmZsb2F0VWlPcHRpb25zLmhpZGVPbk1vdXNlTGVhdmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG5cbiAgICAvLyBUb2dnbGUgdmlzaWJpbGl0eSBhbmQgZGV0ZWN0IGNoYW5nZXMgLSBSdW4gb25seSBhZnRlciBuZ09uSW5pdCFcbiAgICB0b2dnbGVWaXNpYmlsaXR5KHN0YXRlOiBib29sZWFuKTogdm9pZCB7XG4gICAgICAgIHRoaXMuX3RvZ2dsZVZpc2liaWxpdHkoc3RhdGUpO1xuICAgICAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bm8tc3RyaW5nLWxpdGVyYWxcbiAgICAgICAgaWYgKCF0aGlzLl9jaGFuZ2VEZXRlY3RvclJlZltcImRlc3Ryb3llZFwiXSkge1xuICAgICAgICAgICAgdGhpcy5fY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgdXBkYXRlKCk6IHZvaWQge1xuICAgICAgICB0aGlzLl9jb21wdXRlUG9zaXRpb24oKTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2NvbXB1dGVQb3NpdGlvbigpOiB2b2lkIHtcbiAgICAgICAgY29uc3QgYXBwZW5kVG9QYXJlbnQgPSB0aGlzLmZsb2F0VWlPcHRpb25zLmFwcGVuZFRvICYmIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5mbG9hdFVpT3B0aW9ucy5hcHBlbmRUbyk7XG4gICAgICAgIGlmIChhcHBlbmRUb1BhcmVudCkge1xuICAgICAgICAgICAgY29uc3QgcGFyZW50ID0gdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LnBhcmVudE5vZGU7XG4gICAgICAgICAgICBpZiAocGFyZW50ICE9PSBhcHBlbmRUb1BhcmVudCkge1xuICAgICAgICAgICAgICAgIHBhcmVudCAmJiBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50KTtcbiAgICAgICAgICAgICAgICBhcHBlbmRUb1BhcmVudC5hcHBlbmRDaGlsZCh0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXJyb3dFbGVtZW50ID0gdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZmxvYXQtdWktYXJyb3dcIik7XG4gICAgICAgIGNvbnN0IGFycm93TGVuID0gYXJyb3dFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICAvLyBHZXQgaGFsZiB0aGUgYXJyb3cgYm94J3MgaHlwb3RlbnVzZSBsZW5ndGhcbiAgICAgICAgY29uc3QgZmxvYXRpbmdPZmZzZXQgPSBNYXRoLnNxcnQoMiAqIGFycm93TGVuICoqIDIpIC8gMjtcbiAgICAgICAgY29uc3QgcGFyc2VkQXV0b0FsaWdubWVudDogQWxpZ25tZW50IHwgdW5kZWZpbmVkID0gKHRoaXMuZmxvYXRVaU9wdGlvbnMucGxhY2VtZW50Py5yZXBsYWNlKFwiYXV0by1cIiwgXCJcIikgfHwgdm9pZCAwKSBhcyBBbGlnbm1lbnQgfCB1bmRlZmluZWQ7XG4gICAgICAgIC8vIFNpbmNlIFwiYXV0b1wiIGRvZXNuJ3QgcmVhbGx5IGV4aXN0IGluIGZsb2F0aW5nLXVpIHdlIHBhc3MgdW5kZWZpbmVkIHRvIGhhdmUgYXV0b1xuICAgICAgICBjb25zdCBwYXJzZWRQbGFjZW1lbnQgPSAhdGhpcy5mbG9hdFVpT3B0aW9ucy5wbGFjZW1lbnQgfHwgdGhpcy5mbG9hdFVpT3B0aW9ucy5wbGFjZW1lbnQuaW5kZXhPZihOZ3hGbG9hdFVpUGxhY2VtZW50cy5BVVRPKSA9PT0gMFxuICAgICAgICAgICAgPyB2b2lkIDBcbiAgICAgICAgICAgIDogKHRoaXMuZmxvYXRVaU9wdGlvbnMucGxhY2VtZW50IGFzIFBsYWNlbWVudCk7XG4gICAgICAgIGNvbnN0IHBvcHBlck9wdGlvbnM6IFBhcnRpYWw8Q29tcHV0ZVBvc2l0aW9uQ29uZmlnPiA9IHtcbiAgICAgICAgICAgIHBsYWNlbWVudDogcGFyc2VkUGxhY2VtZW50LFxuICAgICAgICAgICAgc3RyYXRlZ3k6IHRoaXMuZmxvYXRVaU9wdGlvbnMucG9zaXRpb25GaXhlZCA/IFwiZml4ZWRcIiA6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgICAgIG1pZGRsZXdhcmU6IFtcbiAgICAgICAgICAgICAgICBvZmZzZXQoZmxvYXRpbmdPZmZzZXQpLFxuICAgICAgICAgICAgICAgIC4uLih0aGlzLmZsb2F0VWlPcHRpb25zLnByZXZlbnRPdmVyZmxvd1xuICAgICAgICAgICAgICAgICAgICAgICAgPyBbZmxpcCgpXVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBbXVxuICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgc2hpZnQoe2xpbWl0ZXI6IGxpbWl0U2hpZnQoKX0pLFxuICAgICAgICAgICAgICAgIGFycm93KHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogYXJyb3dFbGVtZW50LFxuICAgICAgICAgICAgICAgICAgICBwYWRkaW5nOiA0XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIF1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gU2luY2UgcHJldmVudE92ZXJmbG93IHVzZXMgXCJmbGlwXCIgYW5kIFwiZmxpcFwiIGNhbid0IGJlIHVzZWQgd2l0aCBcImF1dG9QbGFjZW1lbnRcIiB3ZSBnZXQgaGVyZSBvbmx5IGlmIGJvdGggY29uZGl0aW9ucyBhcmUgZmFsc3lcbiAgICAgICAgaWYgKCF0aGlzLmZsb2F0VWlPcHRpb25zLnByZXZlbnRPdmVyZmxvdyAmJiAhcG9wcGVyT3B0aW9ucy5wbGFjZW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kYXJpZXNFbGVtZW50ID0gdGhpcy5mbG9hdFVpT3B0aW9ucy5ib3VuZGFyaWVzRWxlbWVudFxuICAgICAgICAgICAgICAgID8gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLmZsb2F0VWlPcHRpb25zLmJvdW5kYXJpZXNFbGVtZW50KVxuICAgICAgICAgICAgICAgIDogdGhpcy5yZWZlcmVuY2VPYmplY3QucGFyZW50RWxlbWVudDtcbiAgICAgICAgICAgIHBvcHBlck9wdGlvbnMubWlkZGxld2FyZS5wdXNoKFxuICAgICAgICAgICAgICAgIGF1dG9QbGFjZW1lbnQoe1xuICAgICAgICAgICAgICAgICAgICBjcm9zc0F4aXM6ICEwLFxuICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQ6IHBhcnNlZEF1dG9BbGlnbm1lbnQsXG4gICAgICAgICAgICAgICAgICAgIGF1dG9BbGlnbm1lbnQ6IHRoaXMuZmxvYXRVaU9wdGlvbnMucGxhY2VtZW50ID09PSBOZ3hGbG9hdFVpUGxhY2VtZW50cy5BVVRPLFxuICAgICAgICAgICAgICAgICAgICBib3VuZGFyeTogYm91bmRhcmllc0VsZW1lbnRcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBjb21wdXRlUG9zaXRpb24odGhpcy5yZWZlcmVuY2VPYmplY3QsIHRoaXMuZmxvYXRVaVZpZXdSZWYubmF0aXZlRWxlbWVudCwge1xuICAgICAgICAgICAgLi4ucG9wcGVyT3B0aW9uc1xuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oKHttaWRkbGV3YXJlRGF0YSwgeCwgeSwgcGxhY2VtZW50fSkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNpZGUgPSBwbGFjZW1lbnQuc3BsaXQoXCItXCIpWzBdO1xuICAgICAgICAgICAgICAgIHRoaXMuZmxvYXRVaVZpZXdSZWYubmF0aXZlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWZsb2F0LXVpLXBsYWNlbWVudFwiLCBzaWRlKTtcbiAgICAgICAgICAgICAgICBpZiAobWlkZGxld2FyZURhdGEuYXJyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdGljQXJyb3dTaWRlID0gdGhpcy5fc3RhdGljQXJyb3dTaWRlc1tzaWRlXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZHluYW1pY0Fycm93U2lkZSA9IHRoaXMuX2R5bmFtaWNBcnJvd1NpZGVzW3NpZGVdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkeW5hbWljU2lkZUF4aXMgPSB0aGlzLl9zaWRlQXhpc1tkeW5hbWljQXJyb3dTaWRlXTtcbiAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihhcnJvd0VsZW1lbnQuc3R5bGUsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvdHRvbTogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IFwiXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICByaWdodDogXCJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFtkeW5hbWljQXJyb3dTaWRlXTogbWlkZGxld2FyZURhdGEuYXJyb3dbZHluYW1pY1NpZGVBeGlzXSAhPSBudWxsID8gYCR7bWlkZGxld2FyZURhdGEuYXJyb3dbZHluYW1pY1NpZGVBeGlzXX1weGAgOiBcIlwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgW3N0YXRpY0Fycm93U2lkZV06IGAkey1hcnJvd0xlbiAvIDJ9cHhgXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKHRoaXMuZmxvYXRVaVZpZXdSZWYubmF0aXZlRWxlbWVudC5zdHlsZSwge1xuICAgICAgICAgICAgICAgICAgICBsZWZ0OiBgJHt4fXB4YCxcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBgJHt5fXB4YFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRoaXMudG9nZ2xlVmlzaWJpbGl0eSghMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5vblVwZGF0ZT8uKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgX2NyZWF0ZUFycm93U2VsZWN0b3IoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGBkaXYjJHt0aGlzLmlkfS5mbG9hdC11aS1jb250YWluZXIgPiAuZmxvYXQtdWktYXJyb3cubmd4cF9fZm9yY2UtYXJyb3dgO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBfZGV0ZXJtaW5lQXJyb3dDb2xvcigpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZsb2F0VWlPcHRpb25zLnN0eWxlcyB8fCB0aGlzLmFycm93Q29sb3IpIHtcblxuICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJ1bGVWYWx1ZSA9IHRoaXMuZmxvYXRVaU9wdGlvbnMuc3R5bGVzW1wiYmFja2dyb3VuZC1jb2xvclwiXSB8fCB0aGlzLmZsb2F0VWlPcHRpb25zLnN0eWxlcy5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgIGlmICh0aGlzLmFycm93Q29sb3IgPT09IHJ1bGVWYWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXJyb3dDb2xvciA9IHJ1bGVWYWx1ZTtcbiAgICAgICAgbGV0ICRzdHlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke3RoaXMuX3N0eWxlSWR9YCkgYXMgSFRNTFN0eWxlRWxlbWVudDtcbiAgICAgICAgY29uc3Qgc3R5bGVDb250ZW50ID0gdGhpcy5hcnJvd0NvbG9yID9cbiAgICAgICAgICAgIGAke3RoaXMuX2NyZWF0ZUFycm93U2VsZWN0b3IoKX06YmVmb3JlIHsgYmFja2dyb3VuZC1jb2xvcjogJHt0aGlzLmFycm93Q29sb3J9OyB9YCA6IFwiXCI7XG4gICAgICAgIGlmICghJHN0eWxlKSB7XG4gICAgICAgICAgICAkc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIikgYXMgSFRNTFN0eWxlRWxlbWVudDtcbiAgICAgICAgICAgICRzdHlsZS5pZCA9IHRoaXMuX3N0eWxlSWQ7XG4gICAgICAgICAgICAkc3R5bGUuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRleHQvY3NzXCIpO1xuICAgICAgICAgICAgZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCgkc3R5bGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpuby1zdHJpbmctbGl0ZXJhbFxuICAgICAgICBpZiAoJHN0eWxlW1wic3R5bGVTaGVldFwiXSkge1xuICAgICAgICAgICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm5vLXN0cmluZy1saXRlcmFsXG4gICAgICAgICAgICAkc3R5bGVbXCJzdHlsZVNoZWV0XCJdLmNzc1RleHQgPSBzdHlsZUNvbnRlbnQ7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIHJlcXVpcmVkIGZvciBJRTggYW5kIGJlbG93LlxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJHN0eWxlLmlubmVySFRNTCA9IHN0eWxlQ29udGVudDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByb3RlY3RlZCBfdG9nZ2xlVmlzaWJpbGl0eShzdGF0ZSk6IHZvaWQge1xuICAgICAgICB0aGlzLmRpc3BsYXlUeXBlID0gW1wibm9uZVwiLCBcImJsb2NrXCJdWytzdGF0ZV07XG4gICAgICAgIHRoaXMub3BhY2l0eSA9ICtzdGF0ZTtcbiAgICAgICAgdGhpcy5hcmlhSGlkZGVuID0gYCR7IXN0YXRlfWA7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTtcbiAgICB9XG59XG4iLCI8ZGl2ICNmbG9hdFVpVmlld1JlZlxuICAgICBbYXR0ci5pZF09XCJpZFwiXG4gICAgIFtjbGFzcy5mbG9hdC11aS1jb250YWluZXJdPVwiIWZsb2F0VWlPcHRpb25zLmRpc2FibGVEZWZhdWx0U3R5bGluZ1wiXG4gICAgIFtjbGFzcy5mbG9hdC11aS1hbmltYXRpb25dPVwiIWZsb2F0VWlPcHRpb25zLmRpc2FibGVBbmltYXRpb25cIlxuICAgICBbY2xhc3MuZmxvYXQtdWktZml4ZWRdPVwiZmxvYXRVaU9wdGlvbnMucG9zaXRpb25GaXhlZFwiXG4gICAgIFtzdHlsZS5kaXNwbGF5XT1cImRpc3BsYXlUeXBlXCJcbiAgICAgW3N0eWxlLm9wYWNpdHldPVwib3BhY2l0eVwiXG4gICAgIFtuZ1N0eWxlXT1cImZsb2F0VWlPcHRpb25zLnN0eWxlc1wiXG4gICAgIFtuZ0NsYXNzXT1cImV4dHJhY3RBcHBsaWVkQ2xhc3NMaXN0RXhwcihmbG9hdFVpT3B0aW9ucy5hcHBseUNsYXNzKVwiXG4gICAgIGF0dHIuYXJpYS1oaWRkZW49XCJ7e2FyaWFIaWRkZW59fVwiXG4gICAgIFthdHRyLmFyaWEtZGVzY3JpYmVkYnldPVwiZmxvYXRVaU9wdGlvbnMuYXJpYURlc2NyaWJlIHx8IG51bGxcIlxuICAgICBhdHRyLnJvbGU9XCJ7e2Zsb2F0VWlPcHRpb25zLmFyaWFSb2xlfX1cIj5cbiAgICA8ZGl2ICpuZ0lmPVwidGV4dFwiXG4gICAgICAgICBjbGFzcz1cIm5neHBfX2lubmVyXCJcbiAgICAgICAgIFtpbm5lckhUTUxdPVwidGV4dFwiPlxuICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgPC9kaXY+XG4gICAgPGRpdiAqbmdJZj1cIiF0ZXh0XCJcbiAgICAgICAgIGNsYXNzPVwibmd4cF9faW5uZXJcIj5cbiAgICAgICAgPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PlxuICAgIDwvZGl2PlxuICAgIDxkaXYgY2xhc3M9XCJmbG9hdC11aS1hcnJvd1wiXG4gICAgICAgICBbY2xhc3Mubmd4cF9fZm9yY2UtYXJyb3ddPVwiYXJyb3dDb2xvclwiXG4gICAgICAgICBbbmdDbGFzc109XCJleHRyYWN0QXBwbGllZENsYXNzTGlzdEV4cHIoZmxvYXRVaU9wdGlvbnMuYXBwbHlBcnJvd0NsYXNzKVwiPjwvZGl2PlxuXG48L2Rpdj5cbiJdfQ==